<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>Bootstrap</title>
  <link rel="stylesheet" type="text/css" href="../assets/css/semantic.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/typo.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/app.css">
</head>
<body>
  <!-- start of header -->
  <header id="header" class="ui inverted segment">
    <div class="ui centered grid container">
      <div class="row">
        <div class="twelve wide column">
          <div class="ui container inverted secondary pointing menu">
            <a href="./index.html" id="logo" class="item">
              Antix Blue's Noise Player
            </a>
            <div class="right menu">
              <a href="./about.html" class="item">About</a>
              <span class="item">|</span>
              <a href="#" class="item">Instagram</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- start of header -->

  <!-- start of content -->
  <div id="content" class="ui stackable centered grid container typo">
    <div class="row">
      <div class="twelve wide column">
        <h1 id="title" class="serif">
          rbenv/pyenv #1 eval "$(pyenv init -)" 做了什么
        </h1>
        <div class="ui two column grid">
          <div class="column">
            <h5 id="pub-date" class="ui grey sub header">发行日期：2014年08月24日</h5>
          </div>
          <div class="right aligned column">
            <div class="ui horizontal link list">
              <a class="item">
                #rbenv
              </a>
              <a class="item">
                #pyenv
              </a>
              <a class="item">
                #bash
              </a>
              <a class="item">
                #shell
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="twelve wide column">
        <h2 class="serif">概述</h2>
        <p><a class="reference external" href="https://github.com/yyuu/pyenv">pyenv</a> 是我日常开发过程中常用来管理python 版本和virtualenv 的工具。甚至可以说，我几乎每天都在使用了 <a class="reference external" href="https://github.com/yyuu/pyenv">pyenv</a> 的bash 环境下工作。</p>
        <p>其实 <a class="reference external" href="https://github.com/yyuu/pyenv">pyenv</a> 是从fork <a class="reference external" href="https://github.com/sstephenson/rbenv">rbenv</a> 而来，两者的核心代码完全一致。<a class="reference external" href="https://github.com/sstephenson/rbenv">rbenv</a> 是用来管理ruby environment 的，其作者是 <a class="reference external" href="https://basecamp.com">Basecamp</a> 的 <a class="reference external" href="https://github.com/sstephenson">Sam Stephenson</a> 。</p>
        <p>有趣的是，rbenv/pyenv 是纯shell 脚本实现的，不依赖于ruby/python 本身。具体的实现过程也很精巧。现在基于Linux 的开发的工作，也基本上都绕不开python。就我所在的团队，包括测试的同学，也都开始使用 <a class="reference external" href="https://github.com/yyuu/pyenv">pyenv</a> 来管理python 环境。</p>
        <p>所以，是时候来更加的深入了解rbenv/pyenv 了。</p>
        <p>在这里，我将以 <a class="reference external" href="https://github.com/yyuu/pyenv">pyenv</a> 为例，分几篇文章来描述rbenv/pyenv 核心代码的具体实现，但是并不涉及ruby-build、pyenv-build 这样的plugin 实现。</p>
        <div class="ui section divider"></div>
        <h2 class="serif">文件结构</h2>
        <p>如下图，pyenv 的文件结构是这样的：</p>
        <figure><img class="ui centered image" alt="元荒川" src="https://farm2.staticflickr.com/1466/24413593625_20f15a0cf4_h.jpg"><figcaption>元荒川附屬小溪</figcaption></figure>
        <ol class="arabic">
        <li><dl class="first docutils">
        <dt>shims 是pyenv 和用户交互的接口层。</dt>
        <dd><p class="first last">这里面存放了我们平时在pyenv shell 环境下所执行的python、pip 等命令文件。当然，这些名为python、pip 的命令文件「并不是真正的python、pip 执行文件」，而是负责命令中转调度的binstub files。</p>
        </dd>
        </dl>
        </li>
        <li><dl class="first docutils">
        <dt>versions 是存放各个python 版本文件的地方。</dt>
        <dd><p class="first last">里面存放了我们installed 的「真正的python、pip 等文件」。</p>
        </dd>
        </dl>
        </li>
        <li><dl class="first docutils">
        <dt>libexec 是pyenv 的核心代码目录。</dt>
        <dd><p class="first">bin/pyenv 则直接软连接到了libexec/pyenv。我们平时所执行的 <code class="bash">pyenv *</code> 的命令，实际上最后都调用了libexec/pyenv-* 文件（除plugin/<em>/bin/pyenv-</em> 命令之外）。</p>
        <p class="last">比如我们执行 <code class="bash">pyenv init -</code> 则实际调用为 <code class="bash">libexec/pyenv-init -</code> 。</p>
        </dd>
        </dl>
        </li>
        <li><dl class="first docutils">
        <dt>plugin 是存放plugin 的目录。</dt>
        <dd><p class="first">pyenv 安装时自带了一个叫做python-build 的plugin。它提供了我们安装和卸载python 时所用的 <code class="bash">pyenv install</code>、 <code class="bash">pyenv uninstall</code> 这两个命令。</p>
        <p class="last">其他更多的插件，可看 <a class="reference external" href="https://github.com/yyuu/pyenv/wiki/Plugins">Plugins wiki page</a> ，这里面的 <code class="bash">pyenv-virtualenv</code> 插件可以用来管理virtualenv 环境。</p>
        </dd>
        </dl>
        </li>
        <li><dl class="first docutils">
        <dt>hooks 并不存在叫做hooks 的目录。但是却是pyenv 很有用的一个功能。</dt>
        <dd><p class="first">pyenv 提供了3个hook 点，分别为 <code class="bash"><span class="nb">exec</span></code>、 <code class="bash">rehash</code>、 <code class="bash">which</code>。当在执行 <code class="bash">pyenv-exec</code>、 <code class="bash">pyenv-rehash</code>、 <code class="bash">pyenv-which</code> 时，则会调用hook files。</p>
        <p>这些hook files，可存放的目录为：</p>
        <div class="last"><div class="highlight"><pre>plugins/*/etc/pyenv.d:<span class="si">${</span><span class="nv">PYENV_HOOK_PATH</span><span class="si">}</span>:<span class="si">${</span><span class="nv">PYENV_ROOT</span><span class="si">}</span>/pyenv.d:/usr/local/etc/pyenv.d:/etc/pyenv.d:/usr/lib/pyenv/hooks
        </pre></div>
        </div></dd>
        </dl>
        </li>
        <li><dl class="first docutils">
        <dt>completions 是存放shell completion 的目录。</dt>
        <dd><p class="first last">目前支持的shell 为：bash、fish、zsh。</p>
        </dd>
        </dl>
        </li>
        </ol>
      </div>
    </div>
  </div>
  <!-- end of content -->

  <!-- start of footer -->
  <div class="ui divider"></div>
  <footer id="footer" class="ui centered grid container">
    <div class="row">
      <div class="twelve wide column">
        <div class="ui two column grid">
          <small class="column">
            Designed and Created(2005-2016) by <a href="{{ SITEURL }}/about/">r.4ntix Blue</a>
            <br />
            ✎ Time waits for no one.
          </small>
          <small class="right aligned column">
          Help from <a href="https://www.getlektor.com/">Lektor</a> and <a href="http://semantic-ui.com/">Semantic UI</a>
          <br />
          ☂ Hosting on <a href="https://github.com/">GitHub</a>
        </small>
        </div>
      </div>
    </div>
  </footer>
  <!-- end of footer -->

  <!-- start of script -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="../assets/js/semantic.js"></script>
  <script src="../assets/js/app.js"></script>
  <!-- end of script -->
</body>
</html>
