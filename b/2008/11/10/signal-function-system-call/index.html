<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>signal(sig, function) 系统调用 | Antix Blue&#39;s Noise Player</title>
  
<link rel="stylesheet" type="text/css" href="../../../../../static/pygments.css">

  <link rel="stylesheet" type="text/css" href="../../../../../static/app.css?h=1748ebc5">
</head>
<body>
  <!-- start of header -->
  <header id="header" class="ui inverted segment">
    <div class="ui stackable centered grid container">
      <div class="row">
        <div class="twelve wide column">
          <div class="ui container inverted secondary pointing menu">
            <a href="../../../../../" id="logo" class="item">
              Antix Blue&#39;s Noise Player
            </a>
            <div class="right menu">
              
                <a href="../../../../../about/" class="item">About</a>
              
              <span class="item">|</span>
              
                <a href="http://antix.blue/rock/signal-function-system-call/https:/www.instagram.com/r4ntix" class="item">Instagram</a>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- start of header -->

  <!-- start of content -->
  
  <article id="content" class="ui stackable centered grid container typo">
    <div class="row">
      <div class="twelve wide column">
        <h1 id="title" class="serif">
          signal(sig, function) 系统调用
        </h1>
        <div class="ui two column grid">
          <div class="column">
            <h5 id="pub-date" class="ui grey sub header">发行日期：<time>2008年11月10日</time></h5>
          </div>
          <div class="right aligned column">
            <div class="ui horizontal link list">
              
              <a class="item">
                #c
              </a>
              
              <a class="item">
                #program
              </a>
              
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="twelve wide column">
        
<p>在这星期《操作系统实验指导》上看到了这样一个系统调用：<code>signal(sig, function)</code>，呵呵，很好奇，因为每次这课的系统调用都说得很不清楚，连函数原型也没有。所以导致很多同学写的(也可能是抄的..)程序编译不成功，即使编译成功了程序也出错。</p>
<p>于是翻了翻书，书上说这个系统调用的函数原型是 <code>void (*signal (int sig, void (*func) (int))) (int);</code>，更是一惊，这样的函数原型在学校这种SB 课本上是很少见的，可能有些同学看都看不懂，更别说，好好的调用了。当然 <code>&lt;signal.h&gt;</code> 头文件(跟进去看看就知道了，老外还真细心)为代码用户解决了 <code>conversion from 'int (*)(int)' to 'void (*)(int)'</code> 这样的问题，虽然能成功编译文件，但编译时照样会出现警告！</p>
<p>当然如果你认为“警告”无关紧要的话，你就去死吧。0 warning，0 error ，才是我的追求。</p>
<p><code>void (*signal (int sig, void (*func) (int))) (int);</code> 的原型其实是这样的 <code>void (*p) (int);</code>，有点熟悉了吧？再深入一点 <code>signal (int sig, void (*func) (int));</code>，会引出一个问题，如果 <code>*func</code> 函数是 <code>int (*func) (int)</code> 的怎么办？很多人一不小心就会写成这样。需要强制转换对吧？应该出现ERROR，但为什么，还能编译成功呢？进去 <code>&lt;signal.h&gt;</code> 头文件看看，在75行：</p>
<div class="highlight"><pre><span></span><span class="cm">/* Type of a signal handler.  */</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">__sighandler_t</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__sighandler_t</span> <span class="nf">__sysv_signal</span> <span class="p">(</span><span class="kt">int</span> <span class="n">__sig</span><span class="p">,</span> <span class="n">__sighandler_t</span> <span class="n">__handler</span><span class="p">)</span>
  <span class="n">__THROW</span><span class="p">;</span>
</pre></div>
<p>原来人家都把强制转换做好了的。我们也可以这样，显示的强制转换：</p>
<div class="highlight"><pre><span></span><span class="n">signal</span> <span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span><span class="n">func</span><span class="p">);</span>
<span class="cm">/* 或者可读性好一些的：*/</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">func_t</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">signal</span> <span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="n">func_t</span><span class="p">)</span><span class="n">func</span><span class="p">);</span>
</pre></div>
<p>好了，现在来对这个typedef 进行理解吧，直接看《THE C PROGRAMMING LANGUAGE》 Page.147：</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">PFI</span><span class="p">)</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * creates the type PFI, for &#39;&#39;pointer to function (of two char * arguments) returning int,&#39;&#39; which can be used in contexts like</span>
<span class="cm"> * PFI strcmp, numcmp;</span>
<span class="cm"> */</span>
</pre></div>
<p>现在应该完全理解这个 <code>signal(sig, function)</code> 系统调用了吧。</p>


      </div>
    </div>
  </article>

  <!-- end of content -->

  <!-- start of footer -->
  <div class="ui divider"></div>
  <footer id="footer" class="ui stackable centered grid container">
    <div class="row">
      <div class="twelve wide column">
        <div class="ui two column grid">
          <small class="column">
            Designed and Created(2005-2016) by <a href="../../../../../about/">r.4ntix Blue</a>
            <br />
            ✎ Time waits for no one.
          </small>
          <small class="right aligned column">
            Help from <a href="https://www.getlektor.com/">Lektor</a> and <a href="http://semantic-ui.com/">Semantic UI</a>
            <br />
            ☂ Hosting on <a href="https://github.com/">GitHub</a>
          </small>
        </div>
      </div>
    </div>
  </footer>
  <!-- end of footer -->

  <!-- start of script -->
  <div class="ga-script">
<div id="ga-script"></div>
<script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-47845863-1', 'auto');
        ga('send', 'pageview');
</script>
</div>
  <!-- end of script -->
</body>
</html>
