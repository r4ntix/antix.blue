<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="zh-cmn-Hans" > <![endif]-->
<html class="no-js" lang="zh-cmn-Hans" >

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discuz! 6.x/7.x SODB-2008-13 Check | r.4ntix Shawn's Noise Player</title>

  <link rel="stylesheet" href="http://r.durara.net/theme/css/normalize.css">
  <link rel="stylesheet" href="http://r.durara.net/theme/css/foundation.min.css">
  <link rel="stylesheet" href="http://r.durara.net/theme/css/typo.css">
  <link rel="stylesheet" href="http://r.durara.net/theme/css/pygments.css">
  <link rel="stylesheet" href="http://r.durara.net/theme/css/app.css">

  <script src="http://r.durara.net/theme/js/vendor/modernizr.js"></script>
</head>

<body>
  <!-- start of header -->
  <header class="contain-to-grid">
    <nav class="top-bar" data-topbar>
      <ul class="title-area">
        <li class="name">
          <h1><a href="http://r.durara.net">r.4ntix Shawn's Noise Player</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
      </ul>
      <section class="top-bar-section">
        <!-- Right Nav Section -->
        <ul class="right">
          <li><a href="http://r.durara.net/about/">About</a></li>
          <li>
            <a href="#">|</a>
          </li>
          <li><a href="https://www.readability.com/r4ntix/">Readability</a></li>
          <li><a href="http://instagram.com/r4ntix">Instagram</a></li>
          <li><a href="https://twitter.com/r4ntix">Twitter</a></li>
          <li><a href="https://plus.google.com/112109872395334308066">Google+</a></li>
        </ul>
      </section>
    </nav>
  </header>
  <!-- end of header -->

  <!-- start of content -->
  <div id="content" class="row">
    <div class="medium-9 large-10 columns">
      <div class="article typo textwrap">
        <h1 class="serif">Discuz! 6.x/7.x SODB-2008-13 Check</h1>
        <p>好吧，我承认上个周末，我并没有像往常一样玩一整天的PES2009。实际上在星期六，我用早上的时间看了正则，下午写下了Discuz! 6.x/7.x SODB-2008-13 Check，这个东东。在我写的前一天heige 发布了exp，不得不说这个是对我的一个诱惑。因为很久没看到DZ 出这么严重的洞洞了 :(</p>
<p>说明一下，这不是首发，写出来的那天就被一个朋友在他的blog 上发出来了。不过，发出来只是一个“bug”版本，比如说抓取的结果并不是很好，还有关于google 自动处理机的一些问题。主要的是，并没有整合那个exp，整合的当然不能乱发了。我还是把这个“bug”代码帖一下，记录一下。</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Discuz! 6.x/7.x SODB-2008-13 Check</span>
<span class="c"># 文件中google_page_count 参数是 google 搜索结果的页数，大于0就可以，太大了，google 会认为是自动机而停止处理！</span>
<span class="c"># 如果修改了搜索的关键字，抓取链接需自行处理，本脚本只是简单测试</span>
<span class="c">#</span>
<span class="c">#                              date: 11.15.2008</span>


<span class="nb">help</span><span class="o">()</span>
<span class="o">{</span>
   cat &lt; &lt; HELP
<span class="c">#===================================================#</span>
Discuz! 6.x/7.x SODB-2008-13 Check
+---------------------------------------------------------+
USAGE: dzcheck <span class="o">[</span>-h<span class="o">]</span> google_page_count
OPTIONS: -h <span class="nb">help </span>text
EXAMPLE: ./dzcheck 10
+---------------------------------------------------------+
                                date: 11.15.2008
<span class="c">#===================================================#</span>

HELP
   <span class="nb">exit </span>0
<span class="o">}</span>

error<span class="o">()</span>
<span class="o">{</span>
   <span class="c"># print an error and exit</span>
   <span class="nb">echo</span> <span class="s2">&quot;$1&quot;</span>
   <span class="nb">exit </span>1
<span class="o">}</span>

<span class="c"># the main</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$#&quot;</span> -lt 1 <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">help</span>
<span class="k">fi</span>

<span class="k">while</span> <span class="o">[</span> -n <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>; <span class="k">do</span>
<span class="k">case</span> <span class="nv">$1</span> in
   -h<span class="o">)</span> <span class="nb">help</span>;<span class="nb">shift</span>;; <span class="c"># function help is called</span>
   --<span class="o">)</span> <span class="nb">shift</span>;<span class="nb">break</span>;; <span class="c"># end of options</span>
   -*<span class="o">)</span> error <span class="s2">&quot;error: no such option $1. -h for help&quot;</span>;;
   *<span class="o">)</span> <span class="nb">break</span>;;
<span class="k">esac</span>
<span class="k">done</span>

<span class="nv">countPage</span><span class="o">=</span>0
<span class="nv">flag</span><span class="o">=</span>0
<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;$flag&quot;</span> -lt <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>; <span class="k">do</span>
<span class="k">    </span>wget --no-cookies --user-agent<span class="o">=</span><span class="s2">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&quot;</span> --referer<span class="o">=</span><span class="s2">&quot;http://www.google.cn&quot;</span>  <span class="s2">&quot;http://www.google.cn/search?hl=zh-CN&amp;newwindow=1&amp;q=inurl:bbs/wap/index.php+Powered+by+Discuz!&amp;start=$countPage&amp;sa=N&quot;</span>  -O /tmp/t_url -T 7 -t 4
    <span class="k">for </span>url in <span class="k">$(</span>sed <span class="s1">&#39;s_&lt;p&gt;&lt;a [^&gt;]*href=&quot;[^&quot;]\+\/index\.php\?_\n&amp;\n_g&#39;</span> /tmp/t_url | grep <span class="s2">&quot;&lt;p&gt;&lt;a href=&quot;</span> | awk -F<span class="s2">&quot;\&quot;&quot;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
    <span class="k">do</span>
<span class="k">        </span>wget --no-cookies --user-agent<span class="o">=</span><span class="s2">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&quot;</span> --referer<span class="o">=</span><span class="s2">&quot;http://www.google.cn&quot;</span> --post-data<span class="o">=</span><span class="s1">&#39;action=register&#39;</span> -O /tmp/check -T 7 -t 4 <span class="s2">&quot;$url&quot;</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$(grep &quot;</span>email<span class="s2">&quot; /tmp/check | wc -l)&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;OK! $url &quot;</span>
            <span class="nb">echo</span> <span class="s2">&quot;OK : $url&quot;</span> &gt;&gt; urllist
        <span class="k">else</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;NO! $url &quot;</span>
        <span class="k">fi</span>
<span class="k">    done</span>
<span class="k">    </span><span class="nv">countPage</span><span class="o">=</span><span class="k">$((</span><span class="nv">$countPage</span><span class="o">+</span><span class="m">10</span><span class="k">))</span>
    <span class="nv">flag</span><span class="o">=</span><span class="k">$((</span><span class="nv">$flag</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="k">done</span>
rm -r /tmp/t_url /tmp/check
<span class="nb">echo</span> <span class="s2">&quot;开启WAP注册的结果URL列表保存在当前目录下urllist&quot;</span>

<span class="nb">exit </span>0
</pre></div>

      </div>
    </div>
    <div class="hide-for-small-only medium-3 large-2 columns">
      <ul class="side-nav">
        <li><time datetime="2008-11-17T00:00:00" class="serif">2008年11月17日</time></li>
        <li class="divider"></li>
        <li><span class="serif">Written by</span> <a href="#">r.4ntix Shawn</a></li>
        <li class="divider"></li>
        <li><span class="serif">Categories</span> <a href="#">Writings</a></li>
        <li class="divider"></li>
        <li><span class="serif">Tags</span> <a href="#">discuz</a> <a href="#">security</a> <a href="#">poc</a> <a href="#">bash</a> </li>
      </ul>
    </div>
  </div>
  <!-- end of content -->

  <!-- start of footer -->
  <footer class="row">
    <div class="small-6 medium-6 large-6 columns">
      <small>
        Designed and Created(2005-2014) by <a href="http://r.durara.net/about/">r.4ntix Shawn</a>
        <br />
        ✎ Time waits for no one.
      </small>
    </div>
    <div class="small-6 medium-6 large-6 columns">
      <small class="right">
        Help from <a href="http://blog.getpelican.com/">Pelican</a> and <a href="http://foundation.zurb.com/">Foundation 5</a> and <a href="http://typo.sofish.de/">Typo.css</a>
        <br />
        ☂ Hosting on <a href="https://github.com/">GitHub</a> and <a href="https://gitcafe.com/">GitCafe</a>
      </small>
    </div>
  </footer>
  <!-- end of footer -->

  <script src="http://r.durara.net/theme/js/vendor/jquery.js"></script>
  <script src="http://r.durara.net/theme/js/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>

  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47845863-1', 'durara.net');
    ga('send', 'pageview');
  </script>
</body>

</html>